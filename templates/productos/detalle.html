{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block title %}{{ producto.nombre }} - Tienda Online{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        {% if producto.imagen_principal %}
        <img src="{{ producto.imagen_principal.url }}" class="img-fluid rounded" alt="{{ producto.nombre }}">
        {% else %}
        <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 400px;">
            <i class="bi bi-image" style="font-size: 4rem;"></i>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-6">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'productos:lista' %}">Productos</a></li>
                <li class="breadcrumb-item"><a href="{% url 'productos:por_categoria' producto.categoria.slug %}">{{ producto.categoria.nombre }}</a></li>
                <li class="breadcrumb-item active">{{ producto.nombre }}</li>
            </ol>
        </nav>
        
        <h1>{{ producto.nombre }}</h1>
        <p class="text-muted">SKU: {{ producto.sku }}</p>
        
        <div class="d-flex align-items-center mb-3">
            {% if producto.en_oferta %}
            <div>
                <span class="display-6 text-danger fw-bold">${{ producto.precio_actual }}</span>
                <span class="text-muted text-decoration-line-through ms-2 fs-4">${{ producto.precio }}</span>
                <span class="badge bg-danger ms-2">¡Oferta!</span>
            </div>
            {% else %}
            <span class="display-6 fw-bold">${{ producto.precio }}</span>
            {% endif %}
        </div>
        
        <div class="mb-4">
            <span class="badge {% if producto.disponible %}bg-success{% else %}bg-danger{% endif %} fs-6">
                {% if producto.disponible %}✅ Disponible{% else %}❌ Agotado{% endif %}
            </span>
            {% if producto.destacado %}
            <span class="badge bg-warning ms-2 fs-6">⭐ Destacado</span>
            {% endif %}
        </div>
        
        <p class="lead">{{ producto.descripcion }}</p>
        
        <!-- FORMULARIO PARA AGREGAR AL CARRITO -->
        <form method="post" action="{% url 'carrito:agregar' producto.id %}" class="d-grid gap-2 d-md-flex align-items-center">
            {% csrf_token %}
            <div class="me-3">
                <label for="cantidad" class="form-label">Cantidad:</label>
                <input type="number" name="cantidad" value="1" min="1" max="{{ producto.stock }}" 
                       class="form-control" style="width: 100px;" id="cantidad">
            </div>
            <div class="d-grid gap-2 d-md-flex">
                {% if producto.disponible %}
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-cart-plus"></i> Agregar al Carrito
                </button>
                {% else %}
                <button class="btn btn-secondary btn-lg" disabled>
                    <i class="bi bi-cart-x"></i> Producto Agotado
                </button>
                {% endif %}
                <button type="button" class="btn btn-outline-secondary btn-lg">
                    <i class="bi bi-heart"></i> Favorito
                </button>
            </div>
        </form>
        
        <hr>
        
        <div class="product-info">
            <p><strong>Categoría:</strong> {{ producto.categoria.nombre }}</p>
            <p><strong>Stock disponible:</strong> {{ producto.stock }} unidades</p>
            <p><strong>Estado:</strong> {{ producto.get_estado_display }}</p>
        </div>
    </div>
</div>

<!-- Productos relacionados -->
{% if productos_relacionados %}
<hr class="my-5">
<div class="row">
    <div class="col-12">
        <h3>Productos relacionados</h3>
        <div class="row">
            {% for producto in productos_relacionados %}
            <div class="col-lg-3 col-md-4 col-6 mb-3">
                <div class="card h-100">
                    {% if producto.imagen_principal %}
                    <img src="{{ producto.imagen_principal.url }}" class="card-img-top" alt="{{ producto.nombre }}" style="height: 150px; object-fit: cover;">
                    {% endif %}
                    <div class="card-body">
                        <h6 class="card-title">{{ producto.nombre|truncatewords:5 }}</h6>
                        <p class="card-text fw-bold">${{ producto.precio }}</p>
                    </div>
                    <div class="card-footer">
                        <a href="{% url 'productos:detalle' producto.slug %}" class="btn btn-sm btn-outline-primary w-100">
                            Ver detalles
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}
{% endblock %}