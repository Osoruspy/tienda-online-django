{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block title %}¡Pedido Completado! - Tienda Online{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card border-success">
                <div class="card-header bg-success text-white text-center">
                    <h2><i class="bi bi-check-circle-fill"></i> ¡Pedido Confirmado!</h2>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <i class="bi bi-bag-check" style="font-size: 4rem; color: #28a745;"></i>
                        <h3 class="text-success mt-3">Gracias por tu compra, {{ pedido.nombre_completo }}!</h3>
                        <p class="lead">Tu pedido ha sido procesado exitosamente.</p>
                    </div>
                    
                    <!-- Resumen del Pedido -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h4 class="mb-0">Resumen del Pedido #{{ pedido.id }}</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>Información del Pedido</h5>
                                    <p><strong>Número de Pedido:</strong> #{{ pedido.id }}</p>
                                    <p><strong>Fecha:</strong> {{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</p>
                                    <p><strong>Estado:</strong> <span class="badge bg-primary">{{ pedido.get_estado_display }}</span></p>
                                    <p><strong>Método de Pago:</strong> {{ pedido.get_metodo_pago_display }}</p>
                                </div>
                                <div class="col-md-6">
                                    <h5>Detalles de Costos</h5>
                                    <div class="row">
                                        <div class="col-8">Subtotal:</div>
                                        <div class="col-4 text-end">${{ pedido.subtotal }}</div>
                                        
                                        <div class="col-8">Impuestos (21%):</div>
                                        <div class="col-4 text-end">${{ pedido.impuestos }}</div>
                                        
                                        <div class="col-8">Costo de Envío:</div>
                                        <div class="col-4 text-end">
                                            {% if pedido.costo_envio > 0 %}
                                                ${{ pedido.costo_envio }}
                                            {% else %}
                                                <span class="text-success">Gratis</span>
                                            {% endif %}
                                        </div>
                                        
                                        {% if pedido.descuento > 0 %}
                                        <div class="col-8">Descuento:</div>
                                        <div class="col-4 text-end text-danger">- ${{ pedido.descuento }}</div>
                                        {% endif %}
                                        
                                        <div class="col-12 my-2"><hr></div>
                                        
                                        <div class="col-8"><strong>Total:</strong></div>
                                        <div class="col-4 text-end"><strong class="text-success">${{ pedido.total }}</strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Información de Envío -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Información de Envío</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p>
                                        <strong>{{ pedido.nombre_completo }}</strong><br>
                                        {{ pedido.direccion }}<br>
                                        {{ pedido.ciudad }}<br>
                                        Código Postal: {{ pedido.codigo_postal }}
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p>
                                        <strong>Contacto</strong><br>
                                        Tel: {{ pedido.telefono }}<br>
                                        Email: {{ pedido.email }}
                                    </p>
                                </div>
                            </div>
                            
                            {% if pedido.observaciones %}
                            <div class="mt-3">
                                <strong>Observaciones:</strong><br>
                                {{ pedido.observaciones }}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Productos del Pedido -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Productos en el Pedido</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Producto</th>
                                            <th class="text-center">Cantidad</th>
                                            <th class="text-end">Precio Unitario</th>
                                            <th class="text-end">Subtotal</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in pedido.items.all %}
                                        <tr>
                                            <td>
                                                {% if item.producto %}
                                                    {{ item.producto.nombre }}
                                                    {% if item.producto.imagen_principal %}
                                                    <br>
                                                    <img src="{{ item.producto.imagen_principal.url }}" 
                                                         alt="{{ item.producto.nombre }}" 
                                                         style="width: 50px; height: 50px; object-fit: cover;"
                                                         class="mt-2 rounded">
                                                    {% endif %}
                                                {% else %}
                                                    {{ item.descripcion_personalizada|default:"Producto personalizado" }}
                                                {% endif %}
                                            </td>
                                            <td class="text-center">{{ item.cantidad }}</td>
                                            <td class="text-end">${{ item.precio_unitario }}</td>
                                            <td class="text-end">${{ item.subtotal }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                                            <td class="text-end"><strong>${{ pedido.subtotal }}</strong></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Información Adicional -->
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle"></i> Información Importante</h6>
                        <p class="mb-2">
                            <strong>Estado del pago:</strong> 
                            <span class="badge 
                                {% if pedido.estado_pago == 'pagado' %}bg-success
                                {% elif pedido.estado_pago == 'pendiente' %}bg-warning
                                {% elif pedido.estado_pago == 'fallido' %}bg-danger
                                {% else %}bg-secondary{% endif %}">
                                {{ pedido.get_estado_pago_display }}
                            </span>
                        </p>
                        <p class="mb-0">
                            Hemos enviado un email de confirmación a <strong>{{ pedido.email }}</strong>. 
                            {% if pedido.metodo_pago != 'efectivo' %}
                            Procederemos con el procesamiento de tu pago.
                            {% else %}
                            Puedes realizar el pago al momento de la entrega.
                            {% endif %}
                        </p>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="d-grid gap-2 d-md-flex justify-content-center">
                        <a href="{% url 'productos:lista' %}" class="btn btn-primary btn-lg">
                            <i class="bi bi-bag"></i> Seguir Comprando
                        </a>
                        <a href="{% url 'pedidos:detalle' pedido.id %}" class="btn btn-outline-secondary btn-lg ms-2">
                            <i class="bi bi-list-check"></i> Ver Detalles Completos
                        </a>
                        <a href="{% url 'pedidos:lista' %}" class="btn btn-outline-info btn-lg ms-2">
                            <i class="bi bi-clock-history"></i> Mis Pedidos
                        </a>
                    </div>

                    <!-- Información de Contacto -->
                    <div class="text-center mt-4">
                        <small class="text-muted">
                            ¿Tienes alguna pregunta? Contáctanos a 
                            <a href="mailto:soporte@tiendaonline.com">soporte@tiendaonline.com</a>
                            o al teléfono <strong>+1 234 567 890</strong>
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}